/* Tailwind 指令已移除（改为 antd + 原生 CSS） */

/* ========== 样式基座与设计令牌（Design Tokens） ========== */
@layer base {

  /*
   * 语义化 CSS 变量（HSL 数值，不含 hsl() 包装），以便 Tailwind 在配置中通过
   * hsl(var(--color-xxx)) 引用。变量命名与 shadcn/ui 语义一致，便于复用。
   */
  :root {
    /* 语义色 - 浅色主题 */
    --color-bg: 0 0% 100%;
    --color-fg: 222.2 84% 4.9%;

    --color-muted: 210 40% 96.1%;
    --color-muted-foreground: 215.4 16.3% 46.9%;

    --color-primary: 221.2 83.2% 53.3%;
    /* 品牌主色（蓝） */
    --color-primary-foreground: 210 40% 98%;

    --color-secondary: 210 40% 96.1%;
    --color-secondary-foreground: 222.2 47.4% 11.2%;

    --color-accent: 210 40% 96.1%;
    --color-accent-foreground: 222.2 47.4% 11.2%;

    --color-destructive: 0 84.2% 60.2%;
    --color-destructive-foreground: 210 40% 98%;

    --color-border: 214.3 31.8% 91.4%;
    --color-input: 214.3 31.8% 91.4%;
    --color-ring: 221.2 83.2% 53.3%;

    /* 圆角与阴影（可按需扩展） */
    --radius-sm: 0.375rem;
    /* 6px */
    --radius-md: 0.5rem;
    /* 8px */
    --radius-lg: 0.75rem;
    /* 12px */

    /* 布局与密度令牌（Phase 1） */
    /* 默认标题栏高度，后续按平台覆写 */
    --space-xs: 0.25rem;
    /* 4px */
    --space-sm: 0.5rem;
    /* 8px */
    --space-md: 0.75rem;
    /* 12px */
    --space-lg: 1rem;
    /* 16px */
    --density: 1;
    /* 密度系数：1=默认，>1 更疏，<1 更紧凑（占位） */

    /* 字体令牌（含中英混排回退） */
    --font-sans: ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Noto Sans CJK SC';

    /* 控件高度（输入/按钮等），可按平台覆写 */
    --control-height: 2.5rem;
    /* 40px */
  }

  /* 深色主题覆盖（由 html[data-theme="dark"] 控制） */
  html[data-theme="dark"] {
    --color-bg: 240 10% 3.9%;
    --color-fg: 210 40% 98%;

    --color-muted: 240 3.7% 15.9%;
    --color-muted-foreground: 215 20.2% 65.1%;

    --color-primary: 217.2 91.2% 59.8%;
    --color-primary-foreground: 222.2 47.4% 11.2%;

    --color-secondary: 240 3.7% 15.9%;
    --color-secondary-foreground: 210 40% 98%;

    --color-accent: 240 3.7% 15.9%;
    --color-accent-foreground: 210 40% 98%;

    --color-destructive: 0 62.8% 30.6%;
    --color-destructive-foreground: 0 85.7% 97.3%;

    --color-border: 240 3.7% 15.9%;
    --color-input: 240 3.7% 15.9%;
    --color-ring: 217.2 91.2% 59.8%;
  }

  /* 平台覆写层（Phase 2/Task 4 先行建立变量，具体组件稍后使用） */
  html[data-platform="windows"] {
    --fx-blur: 6px;
    --panel-opacity: 0.8;
    --corner-radius: var(--radius-lg);
    --window-btn-gap: 0.25rem;
  }

  html[data-platform="mac"] {
    --fx-blur: 8px;
    --panel-opacity: 0.72;
    --corner-radius: var(--radius-lg);
    --window-btn-gap: 0.375rem;
  }

  html[data-platform="linux"] {
    --fx-blur: 0px;
    --panel-opacity: 0.8;
    --corner-radius: var(--radius-md);
    --window-btn-gap: 0.25rem;
  }

  html[data-platform="mobile"] {
    --fx-blur: 0px;
    --panel-opacity: 0.92;
    --corner-radius: var(--radius-lg);
    --window-btn-gap: 0.25rem;
    --control-height: 2.75rem;
  }

  /* 全局重置与基线 */
  html,
  body,
  #root {
    height: 100%;
  }

  body {
    margin: 0;
    font-family: var(--font-sans, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji");
    background-color: hsl(var(--color-bg));
    color: hsl(var(--color-fg));
    overscroll-behavior: contain;
    /* 阻止外层滚动穿透，适配桌面与移动 */
    scrollbar-gutter: stable both-edges;
    /* 避免出现/隐藏滚动条导致的抖动 */
  }

  /* 默认边框色与选区/焦点可达性 */
  * {
    border-color: hsl(var(--color-border));
  }

  ::selection {
    background: hsl(var(--color-primary) / 0.18);
  }

  :focus-visible {
    outline: 2px solid hsl(var(--color-ring));
    outline-offset: 2px;
  }

  /* 可达性：减少动效偏好 */
  @media (prefers-reduced-motion: reduce) {
    * {
      transition-duration: 0.01ms !important;
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
    }

    html {
      scroll-behavior: auto;
    }
  }

  /* 强制颜色模式（Windows 高对比度）友好：保留描边与边框可见性 */
  @media (forced-colors: active) {
    :focus-visible {
      outline-color: Highlight;
    }

    * {
      border-color: CanvasText;
    }
  }
}

/* 滚动条样式（跨引擎尽量统一，允许近似差异） */
:root {
  scrollbar-color: hsl(var(--color-muted-foreground) / 0.5) transparent;
  /* Firefox */
  scrollbar-width: thin;
  /* Firefox */
}

/* Chromium/WebKit */
*::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

*::-webkit-scrollbar-track {
  background: transparent;
}

*::-webkit-scrollbar-thumb {
  background-color: hsl(var(--color-muted-foreground) / 0.4);
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

*::-webkit-scrollbar-thumb:hover {
  background-color: hsl(var(--color-muted-foreground) / 0.6);
}

/* 安全区（移动端刘海/圆角屏） */
html[data-platform="mobile"] .safe-area {
  padding-top: max(var(--space-sm), env(safe-area-inset-top));
  padding-bottom: max(var(--space-sm), env(safe-area-inset-bottom));
  padding-left: max(var(--space-sm), env(safe-area-inset-left));
  padding-right: max(var(--space-sm), env(safe-area-inset-right));
}

/* 组件与工具样式：用于聊天界面视觉（玻璃拟物 + 气泡） */
/* ========== 语义组件层：通用容器/工具条/按钮/输入等（纯 CSS） ========== */
.panel {
  border: 1px solid hsl(var(--color-border));
  background-color: hsl(var(--color-bg) / 0.8);
  color: hsl(var(--color-fg));
  border-radius: var(--radius-lg);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  -webkit-backdrop-filter: blur(var(--fx-blur));
  backdrop-filter: blur(var(--fx-blur));
}

.card {
  border: 1px solid hsl(var(--color-border));
  background-color: hsl(var(--color-bg));
  color: hsl(var(--color-fg));
  border-radius: calc(var(--radius-lg) + 4px);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.toolbar {
  height: 2.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0 0.5rem;
  border-bottom: 1px solid hsl(var(--color-border) / 0.6);
  background-color: hsl(var(--color-bg) / var(--panel-opacity));
}

@media (min-width: 640px) {
  .toolbar {
    height: 2.75rem;
  }
}

.btn-ghost {
  color: hsl(var(--color-fg) / 0.8);
}

.btn-ghost:hover {
  color: hsl(var(--color-fg));
  background-color: hsl(var(--color-muted) / 0.7);
}

/* 页面浅色背景渐变 */
.bg-page {
  background-image: linear-gradient(135deg,
      hsl(var(--color-bg)) 0%,
      hsl(var(--color-bg) / 0.98) 70%,
      hsl(var(--color-bg) / 0.96) 100%);
}

/* 玻璃拟物容器（包含回退样式） */
.surface-glass {
  border-radius: var(--radius-lg);
  background-color: hsl(var(--color-bg) / var(--panel-opacity));
  border: 1px solid hsl(var(--color-border) / 0.6);
}

.shadow-glass {
  box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.2);
}

/* 气泡：来消息（灰） */
.bubble-in {
  border-radius: 1rem;
  color: #fff;
  padding: 0.5rem 1rem;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  background-color: hsl(0 0% 45% / 0.8);
  max-width: 80%;
}

/* 气泡：我方（蓝渐变） */
.bubble-out {
  border-radius: 1rem;
  color: #fff;
  padding: 0.5rem 1rem;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  background-image: linear-gradient(90deg, hsl(var(--color-primary) / 0.9), hsl(var(--color-primary)));
  max-width: 80%;
}

/* 气泡尖角（三角形） */
.bubble-tail-in {
  position: relative;
}

.bubble-tail-in::before {
  content: '';
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -6px;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-right: 6px solid hsl(0 0% 45% / 0.8);
}

.bubble-tail-out {
  position: relative;
}

.bubble-tail-out::after {
  content: '';
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  right: -6px;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-left: 6px solid hsl(var(--color-primary));
}

/* 容器查询：在可用时基于容器宽度调整聊天气泡最大宽度 */
@container layout (min-width: 640px) {

  .bubble-in,
  .bubble-out {
    max-width: 70%;
  }
}

@container layout (min-width: 768px) {

  .bubble-in,
  .bubble-out {
    max-width: 60%;
  }
}

@container layout (min-width: 1024px) {

  .bubble-in,
  .bubble-out {
    max-width: 55%;
  }
}

@container layout (min-width: 1280px) {

  .bubble-in,
  .bubble-out {
    max-width: 50%;
  }
}

/* 自定义标题栏拖拽区域控制（Electron/Chromium） */
.titlebar-drag {
  -webkit-app-region: drag;
  user-select: none;
}

.titlebar-no-drag {
  -webkit-app-region: no-drag;
}

/* 标题栏与窗口控件语义样式 */
.titlebar {
  -webkit-app-region: drag;
  display: flex;
  align-items: center;
  justify-content: space-between;
  user-select: none;
  border-bottom: 1px solid hsl(var(--color-border) / 0.6);
  height: 2.5rem;
}

@media (min-width: 640px) {
  .titlebar {
    height: 2.75rem;
  }
}

/* 统一由变量控制高度，如需按断点微调，可在平台覆写层中处理 */
.titlebar-surface {
  background-color: hsl(var(--color-bg) / var(--panel-opacity));
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
}

/* 能力探测：支持时启用模糊，并使用平台变量控制强度 */
@supports (backdrop-filter: blur(0px)) or (-webkit-backdrop-filter: blur(0px)) {
  .toolbar {
    -webkit-backdrop-filter: blur(var(--fx-blur));
    backdrop-filter: blur(var(--fx-blur));
  }

  .titlebar-surface {
    -webkit-backdrop-filter: blur(var(--fx-blur));
    backdrop-filter: blur(var(--fx-blur));
  }

  .surface-glass {
    -webkit-backdrop-filter: blur(var(--fx-blur));
    backdrop-filter: blur(var(--fx-blur));
  }
}

.window-btn {
  -webkit-app-region: no-drag;
  display: grid;
  place-items: center;
  height: 2rem;
  width: 2rem;
  border-radius: 0.375rem;
  color: hsl(var(--color-fg) / 0.8);
}

.window-btn:hover {
  color: hsl(var(--color-fg));
  background-color: hsl(var(--color-muted) / 0.7);
}

.window-btn:focus-visible {
  outline: 1px solid hsl(var(--color-primary) / 0.5);
  outline-offset: 0;
}

.window-btn--close {
  color: hsl(var(--color-destructive));
}

.window-btn--close:hover {
  background-color: hsl(var(--color-destructive) / 0.1);
  color: hsl(var(--color-destructive));
}

.window-btn--close:focus-visible {
  outline-color: hsl(var(--color-destructive) / 0.5);
}

/* 布局辅助：当页面内包含自绘标题栏时，容器使用该类避免遮挡 */

/* ========== Utilities：容器查询启用类（渐进增强） ========== */
.cq {
  container-type: inline-size;
}

.cq-name {
  container-name: layout;
}

/* 标题栏平台化：mac 左侧信号灯布局；Windows/Linux 右侧按钮 */
html[data-platform="mac"] .titlebar {
  -webkit-app-region: drag;
  display: flex;
  align-items: center;
  justify-content: space-between;
  user-select: none;
  border-bottom: 1px solid hsl(var(--color-border) / 0.6);
  height: 2.5rem;
}

@media (min-width: 640px) {
  .titlebar {
    height: 2.75rem;
  }
}

html[data-platform="mac"] .titlebar .titlebar-controls {
  order: -1;
  /* 将窗口按钮移到最左 */
  margin-left: var(--space-sm);
  margin-right: var(--space-sm);
}

/* 窗口按钮容器使用平台化间距 */
.window-controls {
  gap: var(--window-btn-gap);
  display: flex;
  align-items: center;
  padding-left: 0.25rem;
  padding-right: 0.25rem;
  pointer-events: auto;
}

/* antd 文本按钮在浅色主题的 hover/active 可见性增强 */
html[data-theme="light"] .ant-btn.ant-btn-text:not(:disabled):hover,
html[data-theme="light"] .ant-btn.ant-btn-text:not(:disabled):active {
  background-color: hsl(var(--color-muted) / 0.7) !important;
  color: hsl(var(--color-fg)) !important;
}

/* ========== 无 Tailwind 情况下的最小语义类（覆盖本项目实际使用） ========== */
.mf-page {
  position: relative;
  width: 100%;
  height: 100%;
}

.mf-root-row {
  display: flex;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

.mf-sidebar-desktop {
  display: none;
}

@media (min-width: 768px) {
  .mf-sidebar-desktop {
    display: block;
  }
}

.mf-content {
  flex: 1 1 auto;
  min-width: 0;
  container-type: inline-size;
  container-name: layout;
}

.mf-mobile-overlay {
  position: fixed;
  inset: 0;
  z-index: 40;
}

.mf-mobile-overlay .mf-dim {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
}

.mf-mobile-overlay .mf-drawer {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  width: 16rem;
  max-width: 80vw;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
}

.mf-titlebar {
  width: 100%;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  padding: 0 0.5rem;
}

.mf-titlebar .mf-titlebar-spacer {
  -webkit-app-region: drag;
  height: 100%;
  flex: 1 1 auto;
}

.mf-titlebar .mf-titlebar-actions {
  -webkit-app-region: no-drag;
  /* margin-right: -0.25rem; */
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.mf-show-mobile {
  display: block;
}

@media (min-width: 768px) {
  .mf-show-mobile {
    display: none;
  }
}

.mf-chat-surface {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  height: 100%;
}

.mf-chat-body {
  /* 使主体区域占满剩余高度，便于消息区滚动、输入区贴底 */
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: 1rem;
  padding-right: 0.75rem;
}

@media (min-width: 640px) {
  .mf-chat-body {
    padding-right: 1rem;
    gap: 0.5rem;
  }
}

/* 消息列表包裹：占满剩余空间，允许内部滚动 */
.mf-msg-wrap {
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
}

.mf-msg-scroll {
  flex: 1 1 auto;
  min-height: 0;
  padding-right: 0.5rem;
  overflow: auto;
}

@media (min-width: 640px) {
  .mf-msg-scroll {
    padding-right: 1rem;
  }
}

.mf-msg-list {
  padding: 0.5rem 0.5rem 0.5rem 0;
}

.mf-msg-list>*+* {
  margin-top: 0.75rem;
}

@media (min-width: 640px) {
  .mf-msg-list>*+* {
    margin-top: 1rem;
  }
}

.mf-bubble-row {
  display: grid;
  align-items: end;
  gap: 0.75rem;
}

.mf-bubble-row.user {
  grid-template-columns: 1fr auto;
}

.mf-bubble-row.assistant {
  grid-template-columns: auto 1fr;
}

.mf-chat-input {
  /* 底栏输入区：保持在可视区底部 */
  position: sticky;
  bottom: 0;
  margin-top: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0 0.25rem 0;
  /* 与卡片/玻璃表面一致的背景 */
  background-color: hsl(var(--color-bg) / var(--panel-opacity));
  border-top: 1px solid hsl(var(--color-border) / 0.6);
  backdrop-filter: blur(var(--fx-blur));
}

@media (min-width: 640px) {
  .mf-chat-input {
    gap: 0.75rem;
  }
}

/* ========== 聊天面板作用域下的 AntD 输入样式兜底（与卡片背景一致） ========== */
.mf-chat-body .ant-input,
.mf-chat-body .ant-input-textarea,
.mf-chat-body .ant-input-outlined,
.mf-chat-body .ant-input-textarea-outlined,
.mf-chat-body .ant-input-affix-wrapper {
  background-color: hsl(var(--color-bg));
  color: hsl(var(--color-fg));
  border-color: hsl(var(--color-border));
  border-radius: var(--radius-md);
}

/* 调整 TextArea 内部文本与占位符的垂直间距与行高 */
.mf-chat-body .ant-input-textarea textarea {
  padding-block: 10px; /* 上下内边距，居中单行文本 */
  line-height: 1.5;
  min-height: var(--control-height); /* 保证与按钮高度接近 */
}

.mf-chat-body .ant-input::placeholder,
.mf-chat-body .ant-input-textarea::placeholder,
.mf-chat-body .ant-input-textarea textarea::placeholder {
  color: hsl(var(--color-muted-foreground));
}

.mf-chat-body .ant-input:focus,
.mf-chat-body .ant-input:focus-within,
.mf-chat-body .ant-input-outlined:focus,
.mf-chat-body .ant-input-outlined:focus-within,
.mf-chat-body .ant-input-textarea:focus-within,
.mf-chat-body .ant-input-affix-wrapper:focus,
.mf-chat-body .ant-input-affix-wrapper-focused {
  border-color: hsl(var(--color-primary));
  box-shadow: 0 0 0 2px hsl(var(--color-primary) / 0.15);
}

/* 亮色主题下，发送按钮在禁用态的可见性优化（在聊天区域内作用） */
html[data-theme="light"] .mf-chat-body .ant-btn-primary:disabled {
  background-color: hsl(var(--color-muted) / 0.7);
  border-color: hsl(var(--color-border));
  color: hsl(var(--color-muted-foreground));
}

/* 对齐按钮与输入框的高度（使用 large 尺寸时） */
.mf-chat-body .ant-btn-lg {
  height: var(--control-height);
  border-radius: var(--radius-md);
}

/* 侧边栏样式（桌面固定、移动通过抽屉） */
.mf-sidebar {
  position: sticky;
  top: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
  width: 4rem;
  height: 100%;
  padding-bottom: 0.75rem;
  background-color: hsl(var(--color-bg) / 0.95);
  color: hsl(var(--color-fg));
  border-right: 1px solid hsl(var(--color-border) / 0.6);
}

@media (min-width: 640px) {
  .mf-sidebar {
    width: 5rem;
    padding-bottom: 1rem;
  }
}

.mf-sidebar-header {
  -webkit-app-region: drag;
  display: flex;
  height: 2.5rem;
  align-items: center;
  justify-content: center;
  border-bottom: 1px solid hsl(var(--color-border) / 0.6);
  background-color: hsl(var(--color-bg) / var(--panel-opacity));
}

@media (min-width: 640px) {
  .mf-sidebar-header {
    height: 2.75rem;
  }
}

.mf-sidebar-main {
  display: flex;
  width: 100%;
  flex: 1 1 auto;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  margin-top: 0.5rem;
}

.mf-sidebar-footer {
  margin-top: 0.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.mf-sidebar-btn {
  -webkit-app-region: no-drag;
  height: 3rem;
  width: 3rem;
  border-radius: 0.75rem;
  border: 1px solid hsl(var(--color-border) / 0.6);
}

.mf-sidebar-btn.active {
  background-color: hsl(var(--color-primary));
  color: hsl(var(--color-primary-foreground));
  border-color: transparent;
}

.mf-sidebar-btn.active:hover {
  filter: brightness(0.96);
}

/* 屏幕阅读器专用隐藏（a11y） */
.sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}
