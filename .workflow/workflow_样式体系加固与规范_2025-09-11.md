# 功能：样式体系加固与规范（Tailwind + shadcn/ui）

## 核心分析
- **需求目标**: 在现有 Tailwind + PostCSS + shadcn/ui（cva/clsx/tailwind-merge）栈上，建立统一的设计令牌（Design Tokens）与语义组件层，规范类名与主题切换，降低样式漂移与维护成本，同时保持开发效率与无障碍质量。
- **技术选型**: Tailwind v3、PostCSS（autoprefixer）、CSS 变量（colors/space/radius/shadow/typography）、Radix Primitives + shadcn/ui 源码模式、cva + clsx + tailwind-merge、prettier-plugin-tailwindcss、eslint-plugin-tailwindcss。
- **潜在风险**: 
  - 令牌替换可能引发轻微视觉变动；
  - Tailwind 摇树裁剪不当会导致样式缺失；
  - 暗色/主题切换与 Tauri 标题栏区域（`-webkit-app-region`）可能存在交互边界；
  - 组件迁移到 cva 变体过程中需覆盖 hover/focus/active/disabled/aria 状态，避免可达性退化。

# 任务列表
---

## Phase 1: 设计令牌与 Tailwind 映射
- [x] **Task 1: 定义 CSS 变量 Tokens**（`:root` 与 `html[data-theme="dark"]`），涵盖颜色（语义分层：primary/secondary/bg/fg/muted/border）、间距、圆角、阴影、排版尺寸。
- [x] **Task 2: Tailwind 主题映射**（`apps/desktop/tailwind.config.ts`），在 `theme.extend` 中使用 `var(--token)` 映射 `colors/borderRadius/boxShadow/spacing` 等。
- [x] **Task 3: 主题切换机制**：采用 `html[data-theme]` 属性 + `prefers-color-scheme` 兜底，提供 `setTheme('light'|'dark'|'system')` 最小实现。
- [x] **Task 4: 基础排版与重置**：在 `@layer base` 统一字体、行高、滚动条、焦点环与选择颜色，确保与令牌一致。

## Phase 2: 组件语义层（@layer components）
- [x] **Task 5: 提炼语义类**：将通用模式固化为 `.panel`、`.card`、`.toolbar`、`.input-base`、`.btn-ghost` 等，替换零散原子类。
- [x] **Task 6: 聊天气泡整合**：规范 `.bubble-in/.bubble-out/.bubble-tail-*` 的变量用色与尺寸，确保响应式与密度一致。
- [x] **Task 7: 标题栏与窗口控件样式**：抽象 `.titlebar-*` 与 `WindowControls` 相关类，确保拖拽/点击区域与主题适配。

## Phase 3: shadcn/ui 集成与变体
- [x] **Task 8: 扩充核心组件**：在 `src/components/ui/` 增补 `input`, `separator`, `scroll-area` 等（沿用 `Button` 模式），与 `cn` 工具对齐。
- [x] **Task 9: 变体与尺寸体系**：用 `cva` 统一 `variant/size/state` 约定（如 `default/secondary/outline/ghost/link` 与 `sm/md/lg`）。
- [x] **Task 10: 示例替换**：在 `ChatPanel/MessageBubble/Sidebar` 等处用语义类与 `cva` 变体替换散落类名。

## Phase 4: 工具链与质量约束
- [x] **Task 11: Prettier Tailwind 排序**：安装并配置 `prettier-plugin-tailwindcss`，保证类名顺序一致。
- [x] **Task 12: ESLint 规则**：增加 `eslint-plugin-tailwindcss`（基础校验），避免非法类与拼写错误。
- [x] **Task 13: Purge 范围校验**：确认 `tailwind.config.ts` 的 `content` 覆盖 `src/components/ui/**/*`，防止生产构建丢样式。

## Phase 5: 迁移与验收
- [x] **Task 14: 渐进迁移与回归**：首批迁移 `ChatPanel` 标题栏、`Sidebar` 导航按钮、`Input` 到语义类；其余页面将按需逐步替换。
- [x] **Task 15: 可达性检查**：保留/增强焦点环（`focus-visible`）、为图标按钮提供 `aria-label` 与 `sr-only` 文本，维持导航按钮 `aria-pressed`。
  - 备注：修复深色主题下按钮悬停出现纯白背景问题（调整 `Button` 的 `ghost` 变体为基于 Token 的 `hover:bg-muted/70`，并将 `ring-offset-white` 改为 `ring-offset-background`）。
- [ ] **Task 16: 构建与包体积**：待本机 Node 环境就绪后执行 `vite build` 与 `tauri build` 观测产物并记录数据。
- [x] **Task 17: 文档与清理**：在 README 增补「样式体系约定」章节；当前无临时脚本需要清理。
 - [x] **Task 18: 主题切换 UI**：在标题栏新增 `ThemeToggle`（light/dark/system 循环），与窗口控件并排。

---
