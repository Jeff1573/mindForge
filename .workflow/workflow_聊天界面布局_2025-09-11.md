# 功能：聊天界面布局（shadcn/ui 方案）

## 核心分析
- **需求目标**: 基于现有 Tauri + Vite + React + Tailwind 技术栈，完全使用 shadcn/ui 组件（按需引入源码 + Radix）实现示意图所示的聊天界面：左侧暗色竖向侧边栏，右侧玻璃拟物对话卡片（消息气泡列表 + 底部输入栏），保留可扩展性与后续接入对话逻辑的接口。
- **技术选型**: React 18、Tailwind v3、shadcn/ui 源码（`Button`/`Input`/`Textarea`/`ScrollArea`/`Separator` 等）、Radix UI（`@radix-ui/react-scroll-area` 等按需）、可选 `lucide-react` 图标或内联 SVG。
- **潜在风险**: 不同平台 `backdrop-blur` 表现差异；玻璃拟物与大阴影对性能有压力；shadcn/ui 为源码拷贝需手动维护；样式与 tokens 需统一以避免冲突。

# 任务列表
---

## Phase 1: 依赖与基建
- [x] **Task 1: 安装按需依赖**（`@radix-ui/react-scroll-area`, `@radix-ui/react-separator`, `lucide-react` 可选）。
- [x] **Task 2: 引入 shadcn/ui 组件源码**（`button.tsx`, `input.tsx`, `textarea.tsx`, `scroll-area.tsx`, `separator.tsx`），放置到 `apps/desktop/src/components/ui/`。
- [x] **Task 3: 删除自研 Button**（移除 `apps/desktop/src/components/ui/button.tsx`，并替换所有引用为 shadcn 版本）。
- [x] **Task 4: Tailwind 扩展与全局样式**（`tailwind.config.ts` 扩展色板与阴影，`@layer components` 定义 `bg-glass`、`shadow-glass`、`bubble-in/out` 等复用样式；提供无模糊回退）。

## Phase 2: 布局框架
- [x] **Task 5: 创建 `LayoutShell`**（左右两栏：`Sidebar` 固定宽 ~88px + `Content` 自适应，背景渐变）。
- [x] **Task 6: 实现 `Sidebar`**（竖向图标导航项：AI、Chats、Settings、Power、User；悬停与选中态）。
- [x] **Task 7: 实现 `ChatSurface`**（圆角、投影、玻璃拟物容器，包含 Header 占位）。

## Phase 3: 消息与输入
- [x] **Task 8: `MessageBubble` 组件**（incoming/outgoing 变体，带“尖角”，渐变蓝与中性灰两套样式）。
- [x] **Task 9: `MessageList`**（可滚动区域，粘底 + 自动滚动至最新）。
- [x] **Task 10: `ChatInput`**（输入框 + 发送按钮，Enter 发送、Shift+Enter 换行；禁用状态与加载态样式）。

## Phase 4: 演示与细节
- [x] **Task 11: 演示数据接线**（静态消息数组渲染，接口 `Message { id, role, text, ts }`）。
- [x] **Task 12: 微交互与可访问性**（焦点环、键盘导航、aria 属性；阴影与模糊的性能门限）。

## Phase 5: 集成与验收
- [x] **Task 13: 集成到 `App.tsx`**（默认渲染聊天界面）。
- [x] **Task 14: 构建与运行验收**（`pnpm -F @mindforge/desktop check` 已通过）。
- [ ] **Task 15: 清理与文档**（删除临时/测试脚本与示例数据；在本文档勾选完成项并备注；如需，补充 README UI 截图）。

### 本轮新增（自适应优化）
- [x] LayoutShell：响应式边距/间距（px/py/gap），`max-w-screen-xl`，`main` 增加 `min-w-0`。
- [x] Sidebar：`sticky` + 自适应宽度（`w-16 sm:w-20`），限定高度 `h-[calc(100vh-1.5rem)]`，防止在小窗口溢出。
- [x] ChatSurface：加入 `min-h-0` 与响应式内边距，保证内部滚动区域正常伸缩。
- [x] MessageList：容器 `flex-1 min-h-0`，滚动区域右内边距响应式；列表 item 间距响应式。
- [x] 气泡：不同断点的 `max-w-%`，在窄宽度下更易换行，宽屏时更紧凑。

### 本轮修正（去除四周空隙 + 菜单贴边）
- [x] 移除浏览器默认 `body` 外边距（`body { margin: 0; }`）。
- [x] LayoutShell 外层去除 `px/py` 与 `mx-auto/max-w`，使布局贴合窗口边缘且全宽。
- [x] Sidebar 改为 `sticky top-0 h-full p-0 rounded-none`，使菜单贴着窗口四边，无多余内边距。

### 本轮需求实现（顶部移除 + 右上窗口控制 + 侧边栏图标）
- [x] ChatSurface：移除 Header/Separator 顶部区域，仅保留内容；新增 `WindowControls` 组件固定在右上角。
- [x] WindowControls：最小化/最大化切换/关闭按钮，调用 Tauri v2 `@tauri-apps/api/window`。
- [x] Capabilities：新增 `apps/desktop/src-tauri/capabilities/main-capability.json` 允许 window 操作（minimize/toggle-maximize/close）。
- [x] Sidebar：在最上方添加 App 图标（Brain），与菜单项留少量间隔；菜单区 `flex-1` 顶满自适应高度，底部区保持贴底。

---
