# 功能：初始化与基础设施

## 核心分析
- **需求目标**: 在 pnpm+turbo 的 Monorepo 中，搭建 `apps/desktop`(Tauri+Vite+React+Tailwind+shadcn)、`apps/api`(Fastify+TS) 与 `packages/{mcp-server,ui,shared}` 的最小可运行骨架；提供统一环境变量方案与 Qdrant 目录占位，使前后端能本地启动并安装依赖。
- **技术选型**: 
  - 包管理：pnpm workspaces + Turborepo
  - 语言/工具：TypeScript、ESLint、Prettier、tsup
  - 桌面：Tauri v2、Vite、React、Tailwind v4、shadcn/ui
  - 后端：Fastify v5、dotenv、zod
  - 其他：Git 初始化、Rust 工具链（rustup，Windows 需 MSVC）
  - 版本策略：以“最新稳定版”为准；在实施阶段通过 Web 校验版本并锁定
- **潜在风险**: 
  - Rust/MSVC 环境缺失导致 Tauri 构建失败
  - Tailwind v4 与生态插件兼容性问题
  - Node 版本要求（Vite/Fastify 需 Node ≥ 20）
  - 统一环境变量命名的后续迁移成本
  - Windows 平台路径/权限差异

---

## Phase 1: Monorepo 引导与版本确认
- [x] **Task 1: 初始化 pnpm workspace 与 Turborepo 配置**
- [x] **Task 2: 根级工程化（tsconfig.base、eslint、prettier、.gitignore、.npmrc）**
- [x] **Task 3: 通过 Web 校验并记录关键依赖最新稳定版**

### 版本基线（冻结于 2025-09-10）
- Tauri：core `v2.8.5`，CLI `@tauri-apps/cli@v2.8.4`
- Vite：`v7.1.4`
- React：`v19.1.1`
- TypeScript：`v5.8.3`
- Fastify：`v5.6.0`
- Tailwind CSS：`v4.1.13`
- shadcn/ui CLI：`v3.2.1`
- pnpm：`v10.15.1`
- Turborepo：`v2.5.6`

## Phase 2: 环境变量与共享基础
- [x] **Task 4: 创建 `.env.example`（统一：`AI_PROVIDER, AI_MODEL, AI_API_KEY, QDRANT_URL, QDRANT_API_KEY, QDRANT_COLLECTION, MCP_SERVER_URL, MCP_API_KEY`）**
- [x] **Task 5: 在 `packages/shared` 实现 `env` 加载与 zod 校验**
- [x] **Task 6: 在 `packages/shared` 提供通用类型与工具占位**

## Phase 3: 后端 API
- [x] **Task 7: 脚手架 `apps/api`（Fastify + TS + 路由结构）**
 - [x] **Task 8: 实现 `/health` 与 `/env` 路由（引用 shared/env）**
 - [x] **Task 9: 预留 `lib/qdrant/` 目录与接口占位（不接入云端）**

## Phase 4: 桌面端 Desktop
- [x] **Task 10: 脚手架 `apps/desktop`（Tauri v2 + Vite + React）**
 - [x] **Task 11: 集成 Tailwind v4 与 shadcn/ui，添加示例页面与组件**
- [x] **Task 12: 配置脚本：`pnpm dev` 并行启动 API 与 Desktop**

## Phase 5: Packages
- [x] **Task 13: 脚手架 `packages/ui`（tsup 打包 + Button 示例）**
- [x] **Task 14: 脚手架 `packages/mcp-server`（最小服务骨架与脚本）**
- [x] **Task 15: 在 `packages/shared` 导出跨包可复用类型**

## Phase 6: 工具链与文档
- [x] **Task 16: Rust 环境检测与自动安装脚本（Windows rustup/MSVC 提示）**
- [x] **Task 17: 根级 README 与使用说明（安装、启动、调试）**

## Phase 7: 验收与清理
- [x] **Task 18: 验收：依赖安装成功，API/桌面可本地启动（以 smoke/build 非阻塞验证）**
- [ ] **Task 19: 删除临时/测试脚本并在本文档标记完成**

---
