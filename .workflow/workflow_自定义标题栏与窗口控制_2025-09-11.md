# 功能：自定义标题栏与窗口控制

## 核心分析
- **需求目标**: 去掉原生系统标题栏，统一使用应用内自定义标题栏与窗口控制按钮；最小化/最大化(还原)/关闭按钮可用，且最大化与还原图标需随窗口状态实时切换；提供顶部可拖拽区域。
- **技术选型**: Tauri v2（`tauri.conf.json` 关闭 `decorations`）；前端使用 React + Tailwind，`@tauri-apps/api/window` 控制窗口；图标使用 `lucide-react`；CSS 利用 `-webkit-app-region: drag/no-drag` 区分拖拽与点击区域；Tauri v2 能力模型补充 `core:window:allow-is-maximized` 等权限。
- **潜在风险**: 关闭装饰后需严格划分拖拽/非拖拽区域（否则按钮点击失效）；多屏/DPI 缩放触发频繁 resize 事件可能带来不必要的状态刷新；不同平台（Windows/macOS/Linux）在阴影、圆角和双击标题栏行为上存在差异，需要进行基本验证与微调。

# 任务列表
---

## Phase 1: 配置与权限
- [x] **Task 1: 更新 `tauri.conf.json` 关闭原生标题栏**（对主窗口设置 `decorations: false`，全平台统一）。
- [x] **Task 2: 补充 Window 能力权限**（在 `apps/desktop/src-tauri/capabilities/main-capability.json` 增加 `core:window:allow-is-maximized`，保留 `minimize`/`toggle-maximize`/`close`；必要时补 `core:event:default` 以确保监听可用）。
- [ ] **Task 3: 本地启动验证配置生效**（`pnpm -F @mindforge/desktop dev`，确认系统原生标题栏消失）。

## Phase 2: UI 结构与拖拽区域
- [x] **Task 4: 新增 `Titlebar` 组件**（左侧留出可拖拽区域，中/右侧放窗口控制按钮）。
- [x] **Task 5: 集成 `WindowControls` 到 `Titlebar`**（按钮容器使用 `no-drag`，防止拖拽吞掉点击）。
- [x] **Task 6: 在 `LayoutShell` 顶部挂载 `Titlebar`**（调整主内容上边距/高度，避免遮挡）。
- [x] **Task 6.1: 替换 Sidebar 顶部图标为应用 icon**（使用 `apps/desktop/assets/icon.svg`，通过 `<img src>` 引入）。
 - [x] **Task 6.2: 去掉顶部 Titlebar，Sidebar 顶部对齐并承担拖拽区域**（aside 加 `titlebar-drag`，按钮加 `titlebar-no-drag`；WindowControls 改为右上角悬浮）。
 - [x] **Task 6.3: Chat 面板顶部加入可拖拽 Header**（header 可拖拽；下方为消息列表与输入；主体加入 padding）。
 - [x] **Task 6.4: 优化 Header 视觉**（渐变背景 + 分割线 + 顶部圆角，保持纯拖拽无交互）。
 - [x] **Task 6.5: 将窗口控制纳入 Chat Header 右侧**（移除 LayoutShell 悬浮按钮，header 左侧可拖拽，右侧 no-drag）。
 - [x] **Task 8.1: 布局细节调优**（Sidebar 底部 padding、Sidebar 顶部 header 着色、ChatSurface 与消息区去除左 padding）。

## Phase 3: 交互逻辑与状态同步
- [x] **Task 7: `WindowControls` 增加窗口状态**（使用 `isMaximized()` 初始化；监听 `onResized`/`onScaleChanged` 更新；根据状态切换 `Square` 与 `Copy` 图标）。
- [x] **Task 8: 样式与交互细节**（新增 `.titlebar-drag` 与 `.titlebar-no-drag` 样式；hover/active 态；适配亮/暗主题）。

## Phase 4: 验证与收尾
- [ ] **Task 9: 手动验证**（Windows/macOS/Linux 基本行为：拖拽、双击标题栏、最小化/最大化/还原/关闭）。
- [ ] **Task 10: 文档更新与清理**（更新本工作流勾选状态；若产生测试/临时脚本则删除并标记）。

---
